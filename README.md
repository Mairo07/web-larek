# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src\scss\styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Продукт 

```
export interface IProduct {
  id: string;
  title: string;
  description: string;
  image: string;
  category: 'софт-скил' | 'хард-скил' | 'кнопка' | 'дополнительное' | 'другое';
  price: number | null
}
```

Заказ

```
export interface IOrder {
  payment: 'cash' | 'card';
  email: string;
  phone: string;
  address: string;
  total: number;
  items: string[];
}
```

Интерфейс для модели данных списка продуктов

```
export interface IProductsData {
  products: IProduct[];
}
```

Интерфейс для модели данных товаров, добавленных в корзину
```
export interface IBasketData {
  items: TBasketProduct[];
  total: number;
}
```

Данные продукта, используемые в корзине

```
export type TBasketProduct = Pick<IProduct, '_title' | '_price' | '_id'>;
```

Данные о заказе, получаемые из формы модального окна с адресом и формой оплаты

```
export type TOrderInfo = Pick<IOrder, 'payment' | 'address'>;
```

Данные о пользователе, получаемые из формы модального окна с email и телефоном

```
export type TUserInfo = Pick<IOrder, 'email' | 'phone'>;
```


## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице - View
- слой данных, отвечает за хранение и изменение данных - Modal
- презентер, отвечает за связь представления и данных - Presenter

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Публичные методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных - Modal



#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными товаров, полученных с сервера.\
Конструктор класса принимает экземпляр брокера событий\
В полях класса хранятся следующие данные:
- products: IProduct[] - массив объектов товаров
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Класс предоставляет набор методов для взаимодействия с этими данными.
- getProduct(productId: string): IProduct - возвращает карточку по переданному в аргументы id
- setProducts(products: IProduct[]): void - устанавливает полe products после загрузки из api

#### Класс OrderData
Класс отвечает за хранение и логику работы с данными, необходимыми для оформления заказа
- payment: 'cash' | 'card' - поле отвечает за выбранный юзером способ оплаты
- email: string - email пользователя
- phone: string - телефонный номер пользователя
- address: string - адрес доставки товара
- total: number - сумма товаров, выбранных для заказа 
- items: string[] - массив c Id, выбранных для заказа товаров
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Класс предоставляет набор методов для взаимодействия с этими данными.
- setOrderInfo(orderInfo: TOrderInfo): void - сохраняет данные о способе оплаты и адресе в классе
- setUserInfo(userData: TUserInfo): void - сохраняет email и телефон пользователя в классе
- setBascetInfo(basket: IBasketData): void - сохраняет id и сумму товаров в классе
- checkValidation(data: Record<keyof TUserInfo, string> | Record<keyof TOrderInfo, string>): boolean - проверяет объект с данными пользователя на валидность

#### Класс BasketData
Класс отвечает за хранение и работу с данными, выбранными для покупки.\
Конструктор класса принимает инстант брокера событий\
- items: TBasketProduct[] - поле хранит массив с объектами данных о товарах
- total: number - стоимость всех товаров в корзине
- events: IEvents - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Класс предоставляет следующий набор методов
- addItem(product: IProduct): void - добавляет один товар в массив и вызывает событие изменения массива.
- removeItem(product: IProduct): void - удаляет товар из массива. Вызывает событие изменения массива.
- setTotal():void - устанавливает стоимость всех товаров в корзине


### Класс представления - View
Классы представления отвечают за отображения на данных на странице.\

#### Класс Modal
Реализует модальное окно. 
Представляет методы 'open' и 'close' для управлением отображения модального окна. Устанавливает слушатели на клавиатуру для закрытия окна по кнопке 'Esc', клику на оверлей и кнопку-крестик для закрытия модального окна.
- constructor(selector: string, content: object,  events: IEvents) Конструктор принимает селектор, по которому в разметке выбирается элемент модального окна, экземпляр класса контента модального окна и экземпляр брокера событий.

Поля класса:
- modal: HTMLElement  - элемент модального окна
- content: object - экземпляр класса контента
- events: IEvents - брокер событий

#### Класс Basket 
Отвечает за отображение корзины с товарами в модальном окне.
Поля класса отвечают за установку значений в список товаров, находящихся в корзине, общую стоимость товаров и кнопку подтверждения.
Методы:
- setTotal(): void - устанавливает значение общей стоимости товаровж
- isEmpty(): boolean - проверяют наличие товаров в корзине
- isDisable(isEmpty: boolean): void - блокирует кнопку, если корзина пустая


#### Класс ModalForm
Передается в конструктор классу Modal. Предназначен для реализаци контента модального окна с формой содержащей поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей ввода формы.
Предоставляет методы для отображения ошибок и управления активностью кнопки сабмита.\
Поля класса:
- submitButton: HTMLButtonElement - Кнопка подтверждения
- form: HTMLFormElement - элемент формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- errors: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- setInputValues(data: Record<string, string>): void - принимает объект с данными для заполнения полей формы
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError (field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError (field: string): void - очищает текст ошибки под указанным полем ввода
- resetForm(): void - очищает поля ввода формы

#### Класс ModalOrderConfirm
Передается в конструктор классу Modal. Необходим для реализации контента модального окна с кнопкой подтверждения. Принимает в параметрах обработчик, который передается для выполнения при нажатии кнопки подтверждения.\
Поля класса:
- container: HTMLElement - контейнер
- button: HTMLButtonElement - Кнопка модального окна
- handleSubmit: Function - функция, обрабатывающая нажатие на кнопку 


#### Класс Product
Отвечает за отображение информации о товаре карточках на главной странице, в модальном окне с подробной информацией о товаре и пункте списка в корзине. Класс задает данные названия, описания, изображения, категории и цены. 
В конструктор класса передается DOM-элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на интерактивные элементы, в результате взаимодействия с ними пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки карточки товара. Конструктор принимает экземляр класса `EventEmitter` для установки событий.\
Методы:
- setData(productData: IProduct): void - заполняет элементы данными продуктова

#### Класс ProductPreview
Является дочерним  от класса Product. Отвечает за отображение карточки товара в модальном окне.
В поля класса добавляется элемент кнопки модального окна.
Методы:
- cheсkProduct(id: string): string - проверяет цену товара и наличие его в корзине. В зависимости от этого - возращает строку, которая установится в контент кнопки
- setButtonContent(content: string): void - устанавливает контент для кнопки модального окна
- setValid(isValid: boolean): void - изменяет активность кнопки

#### Класс ProductBasket 
Является дочерним от класса Product. Отвечает за отображение товара в списке товаров в корзине.
В поля класса добавляется кнопка удаления товара из корзины и номер товара в корзине.
Методы:
- deleteHandler():void - обработчик нажатия на кнопку удаления из корзины

### Слой комуникации

#### Класс AppApi 
Принимает экземпляр класса Api и обеспечивает взаимодействие с бекэндом сервиса.

## Взаимодействие слоев
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\

*События изменения данных (генерируются классами моделями данных)*
- `products: changed` - изменеие каталога товаров
- `basket: changed` - изменения спискатоваров в корзине

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `product:select` - выбор карточки для отображения в модальном окне
- `product:open` - открытие модального окна просмотра информации о товаре
- `product:add` - добавление товара в корзину
- `product:delete` - удаление товара из корзины
- `basket:open` - открытие модального окна с корзиной 
- `basket:closr` - закрытие модального окна с корзиной 
- `basket:submit` - закрытие модального окна с корзиной прии нажатии кнопки "Оформить"
- `orderInfo:open` - открытие модального окна c информацией  о заказе
- `payment:selected` - выбран способ оплаты
- `orderInfo:input` - изменение данных в форме информации о заказе
- `orderInfo:submit` - закрытие модального окна c информацией  о пользователе при нажатии на кнопку "Далее"
открытие модального окна c информацией  о заказе
- `orderInfo:validation` - событие, сообщающее о необходимости валидации формы модального окна информации о заказе
- `userInfo:input` - изменение данных адреса в форме информации о пользователе
- `userInfo:submit` - закрытие модального окна c информацией о пользователе при нажатии на кнопку "Далее"
- `userInfo:validation` - событие, сообщающее о необходимости валидации формы модального окна информации о пользователе
- `orderSubmit:open` - открытие окна успешного оформление заказа 
- `orderSubmit:submit` - закрытие модального  успешного формление заказа  при нажатии на кнопку "За новыми покупками"
- `modal:close` - закрытие модального окна, нажатием на крестик, 'Ecs' или кликом на оверлей


I


